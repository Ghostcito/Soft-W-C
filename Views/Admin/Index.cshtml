@{
    ViewData["Title"] = "Inicio";
    Layout = "~/Views/Admin/_LayoutAdmin.cshtml"; // layout personalizado para el área de administración
}

<div class="container container-fluid"">
    <h1 class="text-center">Bienvenido, @User.Identity?.Name!</h1>
    <div class="row justify-content-center mt-4">
        <div class="col-md-3 mb-3">
            <a href="#" class="btn btn-primary btn-lg w-100 shadow-sm" style="transition: transform 0.2s;">
                <i class="bi bi-house me-2"></i>Inicio
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a href="#" class="btn btn-success btn-lg w-100 shadow-sm" style="transition: transform 0.2s;">
                <i class="bi bi-list-task me-2"></i>Tareos
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a asp-controller="Sede" asp-action="Index" class="btn btn-warning btn-lg w-100 shadow-sm"
                style="transition: transform 0.2s;">
                <i class="bi bi-geo-alt me-2"></i>Sedes
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a asp-controller="Usuario" asp-action="Index" class="btn btn-info btn-lg w-100 shadow-sm"
                style="transition: transform 0.2s;">
                <i class="bi bi-people me-2"></i>Empleados
            </a>
        </div>

    </div>

<div class="row">
    <!-- Primer Card - Próximos cumpleaños (6 columnas) -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-header bg-gradient-primary py-3">
                <h5 class="mb-0">
                    <i class="fas fa-birthday-cake me-2"></i>
                    Próximos cumpleaños <small>(próximos 30 días)</small>
                </h5>
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush rounded-bottom">
                    @if(ViewBag.ProximosCumpleanios != null && ViewBag.ProximosCumpleanios.Count > 0)
                    {
                        @foreach (var user in ViewBag.ProximosCumpleanios)
                        {
                            var fechaCumpleThisYear = new DateTime(DateTime.Now.Year, user.FechaNacimiento.Month, user.FechaNacimiento.Day);
                            var diasRestantes = (fechaCumpleThisYear - DateTime.Now).Days;
                            
                            // Si ya pasó este año, calcular para el próximo año
                            if(diasRestantes < 0)
                            {
                                fechaCumpleThisYear = fechaCumpleThisYear.AddYears(1);
                                diasRestantes = (fechaCumpleThisYear - DateTime.Now).Days;
                            }

                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong class="text-primary">@user.Nombre @user.Apellido</strong>
                                    <div class="text-muted small">@user.FechaNacimiento.ToString("dd MMMM")</div>
                                </div>
                                <span class="badge bg-light text-primary">
                                    @diasRestantes día@(diasRestantes != 1 ? "s" : "")
                                </span>
                            </li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item text-muted text-center py-4">
                            No hay cumpleaños próximos
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>

    <!-- Segundo Card - Total empleados (6 columnas) -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <h5 class="card-title text-muted mb-4">
                    <i class="fas fa-users me-2"></i>
                    Total de empleados en el sistema
                </h5>
                <div class="display-3 fw-bold text-primary mb-3">@ViewBag.TotalEmpleados</div>
                <div class="progress mt-auto" style="height: 8px;">
                    <div class="progress-bar bg-gradient-primary" 
                        style="width: 100%" 
                        role="progressbar" 
                        aria-valuenow="@ViewBag.TotalEmpleados" 
                        aria-valuemin="0" 
                        aria-valuemax="@(ViewBag.TotalEmpleados + 10)">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


    @* estadisticas creadas con chart.js  *@
    <div class="">

        <canvas id="chartAsistencia"></canvas>         

        <canvas id="chartSede" width="400" height="200"></canvas>
        <canvas id="chartTurno" width="400" height="200"></canvas>
        <canvas id="chartSupervisores" width="400" height="200"></canvas>
        <canvas id="chartHorasSemana" width="400" height="200"></canvas>

        <canvas id="graficoPagosMensuales"></canvas>
    </div>
    <style>
        .btn:hover {
            transform: scale(1.05);
        }
    </style>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Aqui estan los scrpit para todos los graficos, aqui paso los datos -->    
    <script>
        const empleados = @Html.Raw(Json.Serialize(ViewBag.Empleados));
        const horas = @Html.Raw(Json.Serialize(ViewBag.Horas));
        
        window.horasTrabajadasLabels = @Html.Raw(Json.Serialize(ViewBag.Empleados));
        window.horasTrabajadasData = @Html.Raw(Json.Serialize(ViewBag.Horas));

        window.sedesLabels = @Html.Raw(Json.Serialize(ViewBag.Sedes));
        window.sedesData = @Html.Raw(Json.Serialize(ViewBag.EmpleadosPorSede));

        window.turnosLabels = @Html.Raw(Json.Serialize(ViewBag.Turnos));
        window.turnosData = @Html.Raw(Json.Serialize(ViewBag.EmpleadosPorTurno));

        window.supervisoresLabels = @Html.Raw(Json.Serialize(ViewBag.Supervisores));
        window.supervisoresData = @Html.Raw(Json.Serialize(ViewBag.EmpleadosPorSupervisor));

        window.semanasLabels = @Html.Raw(Json.Serialize(ViewBag.Semanas));
        window.semanasData = @Html.Raw(Json.Serialize(ViewBag.HorasPorSemana));

        window.mesesPagosLabels = @Html.Raw(Json.Serialize(ViewBag.MesesPagos));
        window.mesesPagosData = @Html.Raw(Json.Serialize(ViewBag.TotalPagosPorMes));

    </script>

    <script src="~/js/graficos.js" asp-append-version="true"></script>

    <!-- Scripts personalizados -->
    <script src="~/js/site.js" asp-append-version="true"></script>

</div>
